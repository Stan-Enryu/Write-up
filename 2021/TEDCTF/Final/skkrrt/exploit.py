import zlib
import socket 
# print hex(zlib.crc32(chr(0x16)) & 0xffffffff)

check = [0x0D56F2B94, 0x140E363F, 0x0D9D930AC, 0x1B0ECF0B, 0x3E611DAB, 0x0F500AE27, 0x81B17CBD, 0x37D75180, 0x82079EB1, 0x0BD4B551, 0x4DBD0B28, 0x262F97A, 0x4AD0CF31, 0x946B51F4, 0x0F500AE27, 0x1FD5E91E, 0x5BD1C46D, 0x0E8B7BE43, 0x5ED1937E, 0x48BD5C3B, 0x0D80241AA, 0x0C0B506DD, 0x68D2D988, 0x0FF000000, 0x0CB6ED9FC, 0x65BFB3B6, 0x0ABDE5729, 0x0B669474D, 0x4AD0CF31]

check = [0xd56f2b94, 0x140e363f, 0xd9d930ac, 0x1b0ecf0b, 0x3e611dab, 0xf500ae27, 0x81b17cbd, 0x37d75180, 0x82079eb1, 0x0bd4b551, 0x4dbd0b28, 0x0262f97a, 0x4ad0cf31, 0x946b51f4, 0xf500ae27, 0x1fd5e91e, 0x5bd1c46d, 0xe8b7be43, 0x5ed1937e, 0x48bd5c3b, 0xd80241aa, 0xc0b506dd, 0x68d2d988, 0xff000000, 0xcb6ed9fc, 0x65bfb3b6, 0xabde5729, 0xb669474d, 0x4ad0cf31]

print len(check)

def fun1(data):
	local_20=0
	for i in range(28) :
		for j in range(i+1,29) :
			data[j] = (data[j]+ data[i])%0x100 ;
		local_20 = local_20 ^ data[i + 1]
		# print(hex(local_20))
	return data,local_20
	
data = list('CTFTED2021{JYSW3Kkn_bb_bbbaa}')
data = [ord(i) for i in data]
print [hex(i) for i in data]

data,num = fun1(data)
print [hex(i) for i in data],hex(num+0xffffff00)

rand = [3855819591, 2906113562, 452465677, 396278048, 3517374803, 1907112102, 547023641, 534750380, 3013054815, 2663406898, 4050138149, 3906847288, 2715825003, 1557083070, 333115185, 590614980, 3275474807, 347323466, 2129534013, 536712016, 249908611, 801699542, 1511832393, 2429896412, 211273103, 3622429538, 3177303125, 1205218408, 2492346267]


temp = []
for i in range(29):
	temp.append((rand[i]^data[i])%0x100)	
print [hex(i) for i in temp]

temp2 = []

for i in range(29):
	temp2.append((zlib.crc32(chr(temp[i])) & 0xffffffff))
			
print ([hex(i) for i in temp2])
###################################################
print ('-'*100)
flag = []
for i in range(29):
	for char in range(256):
		if ((zlib.crc32(chr(char)) & 0xffffffff) == temp2[i]):
			flag.append(char)
			break
print (flag)

final_flag = []
for i in range(29):
	final_flag.append((rand[i]^flag[i])%0x100)	
print final_flag

final = [0 for i in range(29)]
final[0] = final_flag[0]
for i in range(1,29) :
	temp = final_flag[i]
	for j in range(0,i) :
		temp = (temp-final_flag[j])%0x100 
	final[i] = temp

print (final)
print ("".join([chr(i) for i in final]))

################################################3
print ('-'*100)


soc = socket.socket()
try:
	soc.connect(("rand.qassandra.my.id",8080))
except:
	print("cann't connect")

soc.send("SEED\n".encode())
SEED = '148\n'
SEED = '-108\n'
# SEED = '404\n'
# SEED = '-364\n'
# SEED ='-124\n'
soc.send(SEED.encode())

rand = []
for i in range(29):
	soc.send("RAND\n".encode())
	res = soc.recv(20)
	rand.append(int(res))
print rand
# if (int(rand[0])^flag[0])%0x100 == 0x43 :
# 	print (int(rand[0])^flag[0])%0x100
# 	print 'benar'

# rand = [1397195847, 793020186, 1447113997, 3192404512, 3008676435, 2340583846, 2906491929, 2809308588, 465498719, 983572018, 2443466021, 3952755512, 46208107, 3304617150, 3924856881, 2606371524, 4011206775, 4083580234, 220020029, 1741493328, 939077251, 2403678166, 2191875145, 1653491676, 3307546255, 577741922, 3263425877, 3182996840, 3470069915]
# rand = [3855819591, 2906113562, 452465677, 396278048, 3517374803, 1907112102, 547023641, 534750380, 3013054815, 2663406898, 4050138149, 3906847288, 2715825003, 1557083070, 333115185, 590614980, 3275474807, 347323466, 2129534013, 536712016, 249908611, 801699542, 1511832393, 2429896412, 211273103, 3622429538, 3177303125, 1205218408, 2492346267]
# rand = [3233539399, 2974894106, 2441762317, 1693563680, 2499978067, 2774055590, 970992921, 788899500, 2212909919, 3598704434, 836793893, 3998663736, 1671558507, 757183934, 3221631281, 327160772, 451971447, 3524869706, 2605473341, 2946274640, 1628245891, 4005656790, 2871917897, 877086940, 2108852111, 1828021602, 3349548629, 865807976, 152826267]

################################################3

temp1 = []
for i in range(29):
	for char in range(256):
		if ((zlib.crc32(chr(char)) & 0xffffffff) == check[i]):
			temp1.append(char)
			break
print (temp1)
# temp1[1]= 141

temp2 = []
for i in range(29):
	temp2.append((rand[i]^temp1[i])%0x100)	
print temp2

final = [0 for i in range(29)]
final[0] = temp2[0]
for i in range(1,29) :
	temp = temp2[i]
	for j in range(0,i) :
		temp = (temp-temp2[j])%0x100 
	final[i] = temp

print (final)
print ("".join([chr(i) for i in final]))
#############################################3
print ('-'*100)
import string
# for i2 in string.printable:
# 	for i1 in string.printable:
# 		pay = list('CTFTED2021{'+ i1 + i2+'SW3Kkn_bb_bbbaa}')
# 		data = [ord(i) for i in pay]

# 		data,num = fun1(data)
# 		if (0x94==num):
# 			print hex(num)
# 			print "".join(pay)
			

# 
def brute():
	i = -256
	while(i < 256):
		soc = socket.socket()
		try:
			soc.connect(("rand.qassandra.my.id",8080))
		except:
			print("cann't connect")

		soc.send("SEED\n".encode())
		# brute = '-' + str(i) +'\n'
		brute =  str(i) +'\n'
		soc.send(brute.encode())
		soc.send("RAND\n".encode())
		res1 = soc.recv(20)
		soc.send("RAND\n".encode())
		res2 = soc.recv(20)
		# # print i
		# if (int(res1)^temp1[0])%0x100 == 0x43 and (int(res2)^temp1[1])%0x100 == 151 :
		if (int(res1)^temp1[0])%0x100 == 0x43 :
			print "Ketemu",i
		i +=1

# brute()



